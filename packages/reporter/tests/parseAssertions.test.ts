import simpleLog from "./oneStepLog.json";
import log from "./twoStepLog.json";
import { parseAssertions } from "../src/assertions";
import { AssertionResult } from "@jest/test-result";
import result from "./resultTwoStep.json";

test(`One step test log`, () => {
    const assertions: AssertionResult[] = [];
    simpleLog.testResults.forEach((t) =>
        assertions.push(...(t.assertionResults as AssertionResult[]))
    );
    expect(parseAssertions(assertions)).toEqual(
        JSON.parse(
            `[{"name":"resource","children":[{"name":"student","children":[{"name":"iteration","children":[{"name":"1 ","value":21}]},{"name":"case","children":[{"name":"POSITIVE","value":9},{"name":"NEGATIVE","value":7},{"name":"DESTRUCTIVE","value":5}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":12},{"name":"/Student/{resource:id}/v1","value":2},{"name":"/Student/{resource:id}/v4","value":2},{"name":"/Student","value":5}]},{"name":"error-message","children":[{"name":"","value":9},{"name":"Status mismatch: Expected 404 got 400","value":1},{"name":"Status mismatch: Expected 200,500 got 201","value":1},{"name":"Response bodies did not match","value":3},{"name":"Status mismatch: Expected 404,409 got 500","value":1},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","value":1},{"name":"Status mismatch: Expected 400 got 500","value":3},{"name":"Status mismatch: Expected 201 got 200","value":1},{"name":"Status mismatch: Expected 404 got 200","value":1}]},{"name":"method","children":[{"name":"GET-0","value":2},{"name":"GET-1","value":2},{"name":"DELETE-0","value":2},{"name":"DELETE-1","value":2},{"name":"POST-0","value":3},{"name":"POST-1","value":3},{"name":"PATCH-0","value":3},{"name":"PUT-0","value":2},{"name":"PUT-1","value":2}]}]}]},{"name":"iteration","children":[{"name":"1 ","children":[{"name":"resource","children":[{"name":"student","value":21}]},{"name":"case","children":[{"name":"POSITIVE","value":9},{"name":"NEGATIVE","value":7},{"name":"DESTRUCTIVE","value":5}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":12},{"name":"/Student/{resource:id}/v1","value":2},{"name":"/Student/{resource:id}/v4","value":2},{"name":"/Student","value":5}]},{"name":"error-message","children":[{"name":"","value":9},{"name":"Status mismatch: Expected 404 got 400","value":1},{"name":"Status mismatch: Expected 200,500 got 201","value":1},{"name":"Response bodies did not match","value":3},{"name":"Status mismatch: Expected 404,409 got 500","value":1},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","value":1},{"name":"Status mismatch: Expected 400 got 500","value":3},{"name":"Status mismatch: Expected 201 got 200","value":1},{"name":"Status mismatch: Expected 404 got 200","value":1}]},{"name":"method","children":[{"name":"GET-0","value":2},{"name":"GET-1","value":2},{"name":"DELETE-0","value":2},{"name":"DELETE-1","value":2},{"name":"POST-0","value":3},{"name":"POST-1","value":3},{"name":"PATCH-0","value":3},{"name":"PUT-0","value":2},{"name":"PUT-1","value":2}]}]}]},{"name":"case","children":[{"name":"POSITIVE","children":[{"name":"resource","children":[{"name":"student","value":9}]},{"name":"iteration","children":[{"name":"1 ","value":9}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":5},{"name":"/Student/{resource:id}/v1","value":1},{"name":"/Student/{resource:id}/v4","value":1},{"name":"/Student","value":2}]},{"name":"error-message","children":[{"name":"","value":4},{"name":"Status mismatch: Expected 200,500 got 201","value":1},{"name":"Response bodies did not match","value":3},{"name":"Status mismatch: Expected 201 got 200","value":1}]},{"name":"method","children":[{"name":"GET-0","value":1},{"name":"GET-1","value":1},{"name":"DELETE-0","value":1},{"name":"DELETE-1","value":1},{"name":"POST-0","value":1},{"name":"POST-1","value":1},{"name":"PATCH-0","value":1},{"name":"PUT-0","value":1},{"name":"PUT-1","value":1}]}]},{"name":"NEGATIVE","children":[{"name":"resource","children":[{"name":"student","value":7}]},{"name":"iteration","children":[{"name":"1 ","value":7}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":4},{"name":"/Student/{resource:id}/v1","value":1},{"name":"/Student/{resource:id}/v4","value":1},{"name":"/Student","value":1}]},{"name":"error-message","children":[{"name":"Status mismatch: Expected 404 got 400","value":1},{"name":"","value":3},{"name":"Status mismatch: Expected 404,409 got 500","value":1},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","value":1},{"name":"Status mismatch: Expected 404 got 200","value":1}]},{"name":"method","children":[{"name":"GET-0","value":1},{"name":"GET-1","value":1},{"name":"DELETE-0","value":1},{"name":"DELETE-1","value":1},{"name":"POST-0","value":1},{"name":"POST-1","value":1},{"name":"PATCH-0","value":1}]}]},{"name":"DESTRUCTIVE","children":[{"name":"resource","children":[{"name":"student","value":5}]},{"name":"iteration","children":[{"name":"1 ","value":5}]},{"name":"url","children":[{"name":"/Student","value":2},{"name":"/Student/{resource:id}","value":3}]},{"name":"error-message","children":[{"name":"Status mismatch: Expected 400 got 500","value":3},{"name":"","value":2}]},{"name":"method","children":[{"name":"POST-0","value":1},{"name":"POST-1","value":1},{"name":"PATCH-0","value":1},{"name":"PUT-0","value":1},{"name":"PUT-1","value":1}]}]}]},{"name":"url","children":[{"name":"/Student/{resource:id}","children":[{"name":"resource","children":[{"name":"student","value":12}]},{"name":"iteration","children":[{"name":"1 ","value":12}]},{"name":"case","children":[{"name":"POSITIVE","value":5},{"name":"NEGATIVE","value":4},{"name":"DESTRUCTIVE","value":3}]},{"name":"error-message","children":[{"name":"","value":5},{"name":"Status mismatch: Expected 404 got 400","value":1},{"name":"Response bodies did not match","value":2},{"name":"Status mismatch: Expected 201 got 200","value":1},{"name":"Status mismatch: Expected 400 got 500","value":2},{"name":"Status mismatch: Expected 404 got 200","value":1}]},{"name":"method","children":[{"name":"GET-0","value":2},{"name":"DELETE-0","value":2},{"name":"POST-1","value":3},{"name":"PATCH-0","value":3},{"name":"PUT-1","value":2}]}]},{"name":"/Student/{resource:id}/v1","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"error-message","children":[{"name":"Status mismatch: Expected 200,500 got 201","value":1},{"name":"","value":1}]},{"name":"method","children":[{"name":"GET-1","value":2}]}]},{"name":"/Student/{resource:id}/v4","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"error-message","children":[{"name":"","value":1},{"name":"Status mismatch: Expected 404,409 got 500","value":1}]},{"name":"method","children":[{"name":"DELETE-1","value":2}]}]},{"name":"/Student","children":[{"name":"resource","children":[{"name":"student","value":5}]},{"name":"iteration","children":[{"name":"1 ","value":5}]},{"name":"case","children":[{"name":"POSITIVE","value":2},{"name":"NEGATIVE","value":1},{"name":"DESTRUCTIVE","value":2}]},{"name":"error-message","children":[{"name":"Response bodies did not match","value":1},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","value":1},{"name":"Status mismatch: Expected 400 got 500","value":1},{"name":"","value":2}]},{"name":"method","children":[{"name":"POST-0","value":3},{"name":"PUT-0","value":2}]}]}]},{"name":"error-message","children":[{"name":"","children":[{"name":"resource","children":[{"name":"student","value":9}]},{"name":"iteration","children":[{"name":"1 ","value":9}]},{"name":"case","children":[{"name":"POSITIVE","value":4},{"name":"NEGATIVE","value":3},{"name":"DESTRUCTIVE","value":2}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":5},{"name":"/Student/{resource:id}/v1","value":1},{"name":"/Student/{resource:id}/v4","value":1},{"name":"/Student","value":2}]},{"name":"method","children":[{"name":"GET-0","value":1},{"name":"GET-1","value":1},{"name":"DELETE-0","value":1},{"name":"DELETE-1","value":1},{"name":"POST-1","value":1},{"name":"PATCH-0","value":1},{"name":"PUT-0","value":2},{"name":"PUT-1","value":1}]}]},{"name":"Status mismatch: Expected 404 got 400","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":1}]},{"name":"method","children":[{"name":"GET-0","value":1}]}]},{"name":"Status mismatch: Expected 200,500 got 201","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"POSITIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}/v1","value":1}]},{"name":"method","children":[{"name":"GET-1","value":1}]}]},{"name":"Response bodies did not match","children":[{"name":"resource","children":[{"name":"student","value":3}]},{"name":"iteration","children":[{"name":"1 ","value":3}]},{"name":"case","children":[{"name":"POSITIVE","value":3}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":2},{"name":"/Student","value":1}]},{"name":"method","children":[{"name":"DELETE-0","value":1},{"name":"POST-0","value":1},{"name":"PUT-1","value":1}]}]},{"name":"Status mismatch: Expected 404,409 got 500","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}/v4","value":1}]},{"name":"method","children":[{"name":"DELETE-1","value":1}]}]},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student","value":1}]},{"name":"method","children":[{"name":"POST-0","value":1}]}]},{"name":"Status mismatch: Expected 400 got 500","children":[{"name":"resource","children":[{"name":"student","value":3}]},{"name":"iteration","children":[{"name":"1 ","value":3}]},{"name":"case","children":[{"name":"DESTRUCTIVE","value":3}]},{"name":"url","children":[{"name":"/Student","value":1},{"name":"/Student/{resource:id}","value":2}]},{"name":"method","children":[{"name":"POST-0","value":1},{"name":"POST-1","value":1},{"name":"PATCH-0","value":1}]}]},{"name":"Status mismatch: Expected 201 got 200","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"POSITIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":1}]},{"name":"method","children":[{"name":"POST-1","value":1}]}]},{"name":"Status mismatch: Expected 404 got 200","children":[{"name":"resource","children":[{"name":"student","value":1}]},{"name":"iteration","children":[{"name":"1 ","value":1}]},{"name":"case","children":[{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":1}]},{"name":"method","children":[{"name":"PATCH-0","value":1}]}]}]},{"name":"method","children":[{"name":"GET-0","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":2}]},{"name":"error-message","children":[{"name":"","value":1},{"name":"Status mismatch: Expected 404 got 400","value":1}]}]},{"name":"GET-1","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}/v1","value":2}]},{"name":"error-message","children":[{"name":"Status mismatch: Expected 200,500 got 201","value":1},{"name":"","value":1}]}]},{"name":"DELETE-0","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":2}]},{"name":"error-message","children":[{"name":"Response bodies did not match","value":1},{"name":"","value":1}]}]},{"name":"DELETE-1","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}/v4","value":2}]},{"name":"error-message","children":[{"name":"","value":1},{"name":"Status mismatch: Expected 404,409 got 500","value":1}]}]},{"name":"POST-0","children":[{"name":"resource","children":[{"name":"student","value":3}]},{"name":"iteration","children":[{"name":"1 ","value":3}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1},{"name":"DESTRUCTIVE","value":1}]},{"name":"url","children":[{"name":"/Student","value":3}]},{"name":"error-message","children":[{"name":"Response bodies did not match","value":1},{"name":"Status mismatch: Expected 409,200,201,202,210 got 400","value":1},{"name":"Status mismatch: Expected 400 got 500","value":1}]}]},{"name":"POST-1","children":[{"name":"resource","children":[{"name":"student","value":3}]},{"name":"iteration","children":[{"name":"1 ","value":3}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1},{"name":"DESTRUCTIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":3}]},{"name":"error-message","children":[{"name":"Status mismatch: Expected 201 got 200","value":1},{"name":"","value":1},{"name":"Status mismatch: Expected 400 got 500","value":1}]}]},{"name":"PATCH-0","children":[{"name":"resource","children":[{"name":"student","value":3}]},{"name":"iteration","children":[{"name":"1 ","value":3}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"NEGATIVE","value":1},{"name":"DESTRUCTIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":3}]},{"name":"error-message","children":[{"name":"","value":1},{"name":"Status mismatch: Expected 404 got 200","value":1},{"name":"Status mismatch: Expected 400 got 500","value":1}]}]},{"name":"PUT-0","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"DESTRUCTIVE","value":1}]},{"name":"url","children":[{"name":"/Student","value":2}]},{"name":"error-message","children":[{"name":"","value":2}]}]},{"name":"PUT-1","children":[{"name":"resource","children":[{"name":"student","value":2}]},{"name":"iteration","children":[{"name":"1 ","value":2}]},{"name":"case","children":[{"name":"POSITIVE","value":1},{"name":"DESTRUCTIVE","value":1}]},{"name":"url","children":[{"name":"/Student/{resource:id}","value":2}]},{"name":"error-message","children":[{"name":"Response bodies did not match","value":1},{"name":"","value":1}]}]}]}]`
        )
    );
});

test("Assertion grouping", async () => {
    let assertions: AssertionResult[] = [];
    log.testResults.forEach((t) =>
        assertions.push(...(t.assertionResults as AssertionResult[]))
    );

    assertions = assertions.filter((a) => a.status === "failed");

    const output = parseAssertions(assertions);
    expect(output).toEqual(result);
});
